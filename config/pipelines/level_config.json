{
    "_comment": "LEVEL Pipeline Configuration - All values from configuration.json and pro Indian trading standards",
    "_category": "LEVEL",
    "_description": "Bounce/rejection at key price levels (support, resistance, VWAP, premium/discount zones)",

    "setup_types": [
        "support_bounce_long", "support_bounce_short",
        "resistance_bounce_long", "resistance_bounce_short",
        "range_bounce_long", "range_bounce_short",
        "range_rejection_long", "range_rejection_short",
        "vwap_reclaim_long", "vwap_reclaim_short",
        "vwap_lose_long", "vwap_lose_short",
        "premium_zone_long", "premium_zone_short",
        "discount_zone_long", "discount_zone_short",
        "orb_pullback_long", "orb_pullback_short",
        "order_block_long", "order_block_short"
    ],

    "screening": {
        "time_windows": {
            "_comment": "From configuration.json time_policy - NSE trading hours with opening bell for ICT setups",
            "morning_start": "09:15",
            "morning_end": "12:00",
            "lunch_block_start": "12:00",
            "lunch_block_end": "13:00",
            "afternoon_start": "13:00",
            "afternoon_end": "14:45",
            "last_entry_cutoff": "14:45",
            "opening_bell_start": "09:15",
            "opening_bell_end": "09:30"
        },
        "level_proximity": {
            "_comment": "From configuration.json support_bounce_long - max_level_distance_pct: 2.0",
            "max_distance_atr": 1.5,
            "max_distance_pct": 2.0
        },
        "min_bars_required": 2
    },

    "quality": {
        "_comment": "ALIGNED TO BASELINE: min_t1_rr: 1.2 from configuration.json",
        "min_structural_rr": 1.2,
        "acceptance": {
            "_comment": "From configuration.json support_bounce_long - bounce_tolerance_pct: 0.8",
            "bars": 2,
            "retest_bpct": 0.8,
            "need_vwap_hold": false
        },
        "quality_thresholds": {
            "excellent": {
                "retest_score": 0.9,
                "hold_score": 0.9
            },
            "good": {
                "retest_score": 0.5,
                "hold_score": 0.5
            },
            "fair": {
                "retest_score": 0.5,
                "hold_score": 0.0
            }
        },
        "proximity_bonus": {
            "max_bonus": 1.0,
            "decay_per_atr": 0.2,
            "floor": 0.5
        },
        "quality_multiplier": 2.0
    },

    "gates": {
        "_comment": "From configuration.json - min_volume_mult: 1.5 for support_bounce, order_block",
        "regime_rules": {
            "chop": {
                "allowed": true,
                "size_mult": 1.2
            },
            "trend_up": {
                "_comment": "REVERTED: counter_trend_size_mult 0.5→0.7 as 0.5 killed resistance_bounce_short (+2,569 Rs)",
                "allowed": true,
                "size_mult": 1.0,
                "min_strength_counter_trend": 2.0,
                "counter_trend_size_mult": 0.7
            },
            "trend_down": {
                "_comment": "REVERTED: counter_trend_size_mult 0.5→0.7 to restore profitable level setups",
                "allowed": true,
                "size_mult": 1.0,
                "min_strength_counter_trend": 2.0,
                "counter_trend_size_mult": 0.7
            },
            "squeeze": {
                "allowed": true,
                "size_mult": 1.1
            }
        },
        "volume_confirmation": {
            "_comment": "From configuration.json - support_bounce min_volume_mult: 1.5",
            "threshold": 1.5,
            "bonus_mult": 1.1
        },
        "adx": {
            "_comment": "From configuration.json - vwap_min_adx: 8.0, adx_min_strength: 15",
            "high_adx_threshold": 35,
            "high_adx_size_mult": 0.9,
            "min_adx_for_vwap": 8.0
        },
        "level_touch": {
            "_comment": "From configuration.json - support_bounce_long",
            "min_touches": 2,
            "min_level_age_bars": 5,
            "level_merge_tolerance_pct": 0.3
        },
        "setup_regime_blocks": {
            "_comment": "Data-driven filters from backtest analysis - block unprofitable setup+regime combinations",
            "orb_pullback_long": {
                "_comment": "DATA-DRIVEN (Dec 2024): ADX 30-35 is 75% WR. ADX 20-25 is only 25% WR. Require high ADX for trend trades.",
                "min_adx": 30,
                "blocked_caps": ["micro_cap"],
                "_evidence": "33 trades total. ADX 30-35: 75% WR +Rs 463. ADX 20-25: 25% WR -Rs 1094. trend_up+ADX<30 = 33% WR, -Rs 1982."
            },
            "orb_pullback_short": {
                "_comment": "DATA-DRIVEN (Dec 2024): Only small+micro cap profitable. SL +50%, T1 +50% wider.",
                "allowed_caps": ["small_cap", "micro_cap"],
                "sl_mult": 1.5,
                "t1_mult": 1.5,
                "_evidence": "166 trades small+micro: Rs 114.76 avg with SL+50%/T1+50%. Large/mid cap negative."
            },
            "range_bounce_long": {
                "blocked_regimes": ["chop"],
                "_evidence": "62 trades in chop, -4,048 PnL, 45.2% win rate (vs +565 in trend_up)"
            },
            "discount_zone_long": {
                "blocked_entirely": true,
                "_evidence": "Dec 2024 analysis: 1 trade, -500 Rs, 0% WR - block entirely"
            },
            "vwap_lose_short": {
                "blocked_entirely": true,
                "_evidence": "Dec 2024 analysis: 16 trades, -3,282 Rs, 25% WR. 0% WR in trend_up, 27% in chop. Winners have ADX 37.5 vs losers 27.2"
            },
            "resistance_bounce_short": {
                "_comment": "DATA-DRIVEN (Dec 2024): Block trend_up + ADX<30 + SL/T1 +50%. Rs 165 avg",
                "blocked_regimes": ["trend_up"],
                "max_adx": 30,
                "sl_mult": 1.5,
                "t1_mult": 1.5,
                "_evidence": "ADX<30 + SL+50%/T1+50%: 136 trades Rs 22,468 (Rs 165 avg, 62.5% WR). Baseline: 137 trades Rs 108 avg."
            },
            "range_bounce_short": {
                "_comment": "DATA-DRIVEN (Dec 2024): ADX>=25 + block trend_up + SL/T1 +50%. Rs 324 avg!",
                "blocked_regimes": ["chop", "trend_up"],
                "min_adx": 25,
                "sl_mult": 1.5,
                "t1_mult": 1.5,
                "_evidence": "ADX>=25 + NOT trend_up + SL+50%/T1+50%: 80 trades Rs 25,941 (Rs 324 avg, 68.8% WR). Baseline: 203 trades Rs 86 avg."
            },
            "premium_zone_short": {
                "_comment": "DATA-DRIVEN (Dec 2024): ADX<30 + block micro_cap + block ADX 30-35 (worst zone). SL/T1 +50%.",
                "max_adx": 30,
                "blocked_caps": ["micro_cap"],
                "sl_mult": 1.5,
                "t1_mult": 1.5,
                "_evidence": "96 trades. micro_cap: 29% WR -Rs 1601. ADX 30-35: 26% WR -Rs 3223. chop+ADX<25: 83% WR +Rs 3648. Max ADX 30 blocks worst ADX zone."
            }
        },
        "global_short_adx_filter": {
            "_comment": "Dec 2024 analysis: Block all short trades when ADX < 18",
            "min_adx": 18,
            "_evidence": "ADX < 15 = 0% WR (-1,112 Rs). ADX 20-25 = 62% WR (+11,577 Rs). Min 18 catches weak trends."
        },
        "vwap_freshness": {
            "_comment": "Parameters for fresh reclaim/lose detection",
            "reclaim_lookback_bars": 12,
            "max_bars_above_for_reclaim": 8,
            "lose_lookback_bars": 12,
            "max_bars_below_for_lose": 8
        },
        "vwap_volume": {
            "_comment": "DATA-DRIVEN (Dec 2024): VWAP vol<50k: 18 trades (6W, 12L), blocking = +2,675 Rs improvement",
            "min_volume": 50000,
            "_evidence": "Low volume VWAP trades have poor execution and high slippage. Blocking vol<50k improves P&L by +2,675 Rs"
        },
        "validated_filters": {
            "_comment": "CROSS-RUN VALIDATED FILTERS (Dec 2024) - Consistent across backtest_20251204 and backtest_20251205",
            "resistance_bounce_short_adx": {
                "min_adx": 20,
                "_evidence": "R1: +3,671 Rs (14 trades) | R2: +2,692 Rs (15 trades) - ADX<20 = no trend, bounce fails"
            },
            "resistance_bounce_short_bb_width": {
                "max_bb_width": 0.10,
                "_evidence": "Dec 2024 analysis: bb_width<=0.10 reduces hard_sl from 35%→28%, 46 trades 54% WR Rs 6,465 PnL"
            },
            "support_bounce_long_adx": {
                "min_adx": 22,
                "_evidence": "OPTIMIZED Dec 2024: min_adx 20->22. Big winners avg ADX=24.6 vs losers=20.7. Combined with RSI<45 = 83% WR, Rs 137/trade"
            },
            "premium_zone_short_adx": {
                "min_adx": 15,
                "_evidence": "R1: +1,244 Rs (5 trades) | R2: +1,244 Rs (5 trades) - Very low ADX = no directional movement"
            },
            "support_bounce_long_srr": {
                "max_structural_rr": 3.0,
                "_evidence": "Keep max_structural_rr at 3.0. Winners avg 1.52 vs losers 1.62 - tight stops work better"
            },
            "support_bounce_long_rsi": {
                "max_rsi": 45,
                "_evidence": "OPTIMIZED Dec 2024: RSI<45 (from 50). Big winners avg RSI=39 vs losers=47. Combined with ADX>=22 = 83% WR, Rs 137/trade"
            },
            "long_trade_volume": {
                "min_volume": 150000,
                "_evidence": "Winners have 2x volume (213k vs 107k). Min 150k improves long trade quality"
            },
            "range_bounce_short_chop_adx": {
                "min_adx": 20,
                "_evidence": "Dec 2024: In chop regime, ADX>=20: 10 trades Rs +4,575 (73% WR) vs ADX<20: 19 trades Rs -800. Block low ADX."
            },
            "vwap_lose_short_trend_up": {
                "block_in_trend_up": true,
                "_evidence": "Dec 2024: ALL 4 trend_up trades hit hard_sl (Rs -2,179). Shorting in uptrend = guaranteed loss."
            },
            "premium_zone_short_trend_down_adx": {
                "min_adx": 32,
                "_evidence": "Dec 2024: In trend_down, ADX>=32: 31 trades Rs +4,884 (9 HSL) vs ADX<32: 26 trades Rs -1,865 (16 HSL). Strong trends work."
            },
            "range_bounce_short_adx": {
                "max_adx": 30,
                "_evidence": "6-month backtest Dec 2024: ADX>=30: 79 trades, 35% WR, Rs -9,121 | ADX<30: 119 trades, 53% WR, Rs +26,700"
            },
            "range_bounce_short_rr": {
                "min_rr": 2.0,
                "max_rr": 4.0,
                "_evidence": "6-month backtest Dec 2024: R:R 2-4: 48 trades, 73% WR, Rs +26,512 | R:R<2: 39% WR | R:R>=4: 33% WR"
            },
            "resistance_bounce_short_max_adx": {
                "max_adx": 30,
                "_evidence": "6-month backtest Dec 2024: ADX<30: 149 trades, 53.7% WR, Rs +26,410 | ADX>=30: 133 trades, 48.1% WR, Rs +286"
            },
            "resistance_bounce_short_rr": {
                "min_rr": 1.5,
                "max_rr": 3.0,
                "_evidence": "6-month backtest Dec 2024: R:R 1.5-3: 69 trades, 66.7% WR, Rs +24,945 | R:R<1.5: 40.5% WR | R:R>=3: 42.1% WR"
            }
        },
        "long_specific_filters": {
            "_comment": "DATA-DRIVEN (Dec 2024): Filters specific to long trades based on winner/loser analysis",
            "rsi_max": {
                "threshold": 65,
                "_evidence": "RSI>=70: 9.3% WR (7W/75T). RSI<60: 16.4% WR (32W/195T). High RSI = chasing exhausted moves."
            },
            "entry_time_cutoff": {
                "last_entry_hour": 11,
                "last_entry_minute": 30,
                "_evidence": "09:15-11:00: 19% WR. 11:00-12:00: 11% WR. 13:00+: 7.7% WR. After 14:00: 0% WR."
            },
            "squeeze_regime_boost": {
                "size_mult": 1.3,
                "_evidence": "55.6% of winning longs came from squeeze regime vs only 20% from trend_up."
            },
            "max_hold_minutes": {
                "enabled": true,
                "limit": 120,
                "_evidence": "Pro traders hold 30-90 min max. After 2 hours, momentum fades. Time-based exit if no T1 hit."
            }
        }
    },

    "ranking": {
        "_comment": "ALL values from OLD filters.json rank_* settings to match baseline ranker.py _intraday_strength()",
        "weights": {
            "volume": {
                "_comment": "rank_vol_ratio_divisor=2.0, rank_vol_cap=3.0",
                "divisor": 2.0,
                "cap": 3.0
            },
            "rsi": {
                "_comment": "rank_rsi_mid=50, rank_rsi_divisor=30, rank_rsi_floor=-0.5",
                "mid": 50.0,
                "divisor": 30.0,
                "floor": -0.5
            },
            "rsi_slope": {
                "_comment": "rank_rsi_slope_cap=0.3",
                "cap": 0.3
            },
            "adx": {
                "_comment": "ISSUE 3 FIX: Added cap=0.4 to prevent high ADX from dominating score (losers had 0.615 vs winners 0.475)",
                "mid": 25.0,
                "divisor": 20.0,
                "floor": -0.3,
                "cap": 0.4
            },
            "adx_slope": {
                "_comment": "rank_adx_slope_cap=0.2",
                "cap": 0.2
            },
            "vwap": {
                "_comment": "rank_vwap_bonus=0.3, rank_vwap_penalty=-0.2",
                "aligned_bonus": 0.3,
                "misaligned_penalty": -0.2
            },
            "distance": {
                "_comment": "rank_dist_near_bpct=0.5, rank_dist_near_score=0.4, rank_dist_ok_bpct=1.5, rank_dist_ok_score=0.2, rank_dist_far_score=-0.1",
                "near_bpct": 0.5,
                "near_score": 0.4,
                "ok_bpct": 1.5,
                "ok_score": 0.2,
                "far_score": -0.1
            },
            "squeeze": {
                "_comment": "rank_sq_score_le_50=0.3, rank_sq_score_le_70=0.2, rank_sq_score_ge_90=-0.2",
                "low_bonus": 0.3,
                "mid_bonus": 0.2,
                "high_penalty": -0.2
            },
            "acceptance": {
                "_comment": "rank_acceptance_bonus=0.5",
                "excellent_bonus": 0.5,
                "good_bonus": 0.25
            }
        },
        "daily_trend_multipliers": {
            "aligned": 1.25,
            "counter": 0.75,
            "neutral": 1.0
        },
        "regime_multipliers": {
            "_comment": "Default fallback multipliers",
            "chop": 1.3,
            "squeeze": 1.2,
            "trend_up": 1.0,
            "trend_down": 1.0
        },
        "strategy_regime_multipliers": {
            "_comment": "From baseline ranker.py _get_regime_multiplier() - Strategy-specific overrides for LEVEL setups",
            "support_bounce": {
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 1.0,
                "trend_down": 1.0,
                "default": 1.0
            },
            "resistance_bounce": {
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 1.0,
                "trend_down": 1.0,
                "default": 1.0
            },
            "vwap_reclaim": {
                "_comment": "VWAP strategies similar to mean reversion - chop boost",
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 1.2,
                "trend_down": 1.2,
                "default": 1.2
            },
            "vwap_lose": {
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 1.2,
                "trend_down": 1.2,
                "default": 1.2
            },
            "premium_zone": {
                "_comment": "From baseline: chop=1.3, trend=0.9 - premium/discount zones work best in ranging",
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 0.9,
                "trend_down": 0.9,
                "default": 1.0
            },
            "discount_zone": {
                "_comment": "From baseline: chop=1.3, trend=0.9 - premium/discount zones work best in ranging",
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 0.9,
                "trend_down": 0.9,
                "default": 1.0
            },
            "orb_pullback": {
                "chop": 1.1,
                "squeeze": 1.0,
                "trend_up": 1.1,
                "trend_down": 1.1,
                "default": 1.0
            },
            "order_block": {
                "_comment": "From baseline: trend=1.2, chop=1.1 - order blocks work in all conditions",
                "trend_up": 1.2,
                "trend_down": 1.2,
                "chop": 1.1,
                "squeeze": 1.1,
                "default": 1.0
            }
        }
    },

    "entry": {
        "_comment": "WIDENED (Dec 2024): zone_mult_atr 0.3->0.5, min_zone_pct 0.25->0.30. Zero-trigger setups had 0.10-0.20% zones.",
        "zone_mult_atr": 0.5,
        "min_zone_pct": 0.30,
        "mode": {
            "pullback": "retest",
            "retest": "retest",
            "default": "conditional"
        },
        "triggers": {
            "vwap": "vwap_level",
            "premium_zone": "zone_entry",
            "discount_zone": "zone_entry",
            "default": "level_bounce"
        },
        "ict_zones": {
            "_comment": "From configuration.json ict_comprehensive - premium_threshold_pct: 70, discount_threshold_pct: 30",
            "discount_zone_frac": 0.30,
            "premium_zone_frac": 0.70
        },
        "retest_timeout_minutes": 45
    },

    "targets": {
        "_comment": "DATA-DRIVEN (Dec 2024): Setup-specific targets optimized via backtest analysis",
        "rr_ratios": {
            "support_bounce_long": {
                "_comment": "OPTIMIZED Dec 2024: T1 1.5R (was 1.0R). Wider targets with wider SL = +Rs 3,831 improvement",
                "t1": 1.5,
                "t2": 2.5,
                "t3": 3.0
            },
            "long": {
                "_comment": "Default for other long setups: T1 1.0R",
                "t1": 1.0,
                "t2": 2.0,
                "t3": 2.5
            },
            "short": {
                "_comment": "Shorts keep 1.5R T1 - they have 1.13R avg MFE vs 0.74R for longs",
                "t1": 1.5,
                "t2": 2.5,
                "t3": 3.0
            },
            "t1": 1.5,
            "t2": 2.5,
            "t3": 3.0
        },
        "qty_splits": {
            "_comment": "60-40 split to match OLD config - T3 disabled (0%)",
            "t1": 0.60,
            "t2": 0.40,
            "t3": 0.0
        },
        "caps": {
            "_comment": "FIXED: max_pct was 1.0 (1%) - way too restrictive! Old config uses 100%. Targets need to reach 2-3R for positive expectancy.",
            "t1": {
                "measured_move_frac": 2.0,
                "max_pct": 100.0
            },
            "t2": {
                "measured_move_frac": 3.0,
                "max_pct": 100.0
            },
            "t3": {
                "measured_move_frac": 4.0,
                "max_pct": 100.0
            }
        },
        "trail": {
            "after_t1": {
                "move_sl_to": "entry",
                "offset_atr": 0.05
            },
            "after_t2": {
                "move_sl_to": "t1",
                "offset_atr": 0.0
            }
        }
    },

    "stop_loss": {
        "_comment": "DATA-DRIVEN (Dec 2024): Setup-specific SL optimized via backtest analysis",
        "atr_multiplier": 2.0,
        "min_stop_distance_pct": 0.5,
        "setup_specific": {
            "support_bounce_long": {
                "atr_multiplier": 2.4,
                "_comment": "OPTIMIZED Dec 2024: 1.2x wider SL (2.0→2.4 ATR). Reduces premature stops, combined with T1 1.5R = +Rs 3,831"
            }
        }
    },

    "rsi_penalty": {
        "_comment": "LEVEL: Penalize extreme RSI (price may overshoot level)",
        "extreme_high": 75,
        "extreme_low": 25,
        "penalty_mult": 0.9
    }
}

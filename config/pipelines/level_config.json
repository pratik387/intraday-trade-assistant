{
    "_comment": "LEVEL Pipeline Configuration - All values from configuration.json and pro Indian trading standards",
    "_category": "LEVEL",
    "_description": "Bounce/rejection at key price levels (support, resistance, VWAP, premium/discount zones)",

    "setup_types": [
        "support_bounce_long", "support_bounce_short",
        "resistance_bounce_long", "resistance_bounce_short",
        "range_bounce_long", "range_bounce_short",
        "range_rejection_long", "range_rejection_short",
        "vwap_reclaim_long", "vwap_reclaim_short",
        "vwap_lose_long", "vwap_lose_short",
        "premium_zone_long", "premium_zone_short",
        "discount_zone_long", "discount_zone_short",
        "orb_pullback_long", "orb_pullback_short",
        "order_block_long", "order_block_short"
    ],

    "screening": {
        "_comment": "Category-specific screening filters - DISABLED for A/B baseline",
        "enabled": false,
        "time_windows": {
            "_comment": "From configuration.json time_policy - NSE trading hours with opening bell for ICT setups",
            "morning_start": "09:15",
            "morning_end": "12:00",
            "lunch_block_start": "12:00",
            "lunch_block_end": "13:00",
            "afternoon_start": "13:00",
            "afternoon_end": "14:45",
            "last_entry_cutoff": "14:45",
            "opening_bell_start": "09:15",
            "opening_bell_end": "09:30"
        },
        "level_proximity": {
            "_comment": "From configuration.json support_bounce_long - max_level_distance_pct: 2.0",
            "max_distance_atr": 1.5,
            "max_distance_pct": 2.0
        },
        "min_bars_required": 2
    },

    "quality": {
        "_comment": "ALIGNED TO BASELINE: min_t1_rr: 1.2 from configuration.json",
        "min_structural_rr": 1.2,
        "acceptance": {
            "_comment": "From configuration.json support_bounce_long - bounce_tolerance_pct: 0.8",
            "bars": 2,
            "retest_bpct": 0.8,
            "need_vwap_hold": false
        },
        "quality_thresholds": {
            "excellent": {
                "retest_score": 0.9,
                "hold_score": 0.9
            },
            "good": {
                "retest_score": 0.5,
                "hold_score": 0.5
            },
            "fair": {
                "retest_score": 0.5,
                "hold_score": 0.0
            }
        },
        "proximity_bonus": {
            "max_bonus": 1.0,
            "decay_per_atr": 0.2,
            "floor": 0.5
        },
        "quality_multiplier": 2.0
    },

    "gates": {
        "_comment": "From configuration.json - min_volume_mult: 1.5 for support_bounce, order_block",
        "_ab_baseline_comment": "DISABLED regime gates for A/B baseline",
        "regime_rules": {
            "enabled": false,
            "chop": {
                "allowed": true,
                "size_mult": 1.2
            },
            "trend_up": {
                "_comment": "REVERTED: counter_trend_size_mult 0.5→0.7 as 0.5 killed resistance_bounce_short (+2,569 Rs)",
                "allowed": true,
                "size_mult": 1.0,
                "min_strength_counter_trend": 2.0,
                "counter_trend_size_mult": 0.7
            },
            "trend_down": {
                "_comment": "REVERTED: counter_trend_size_mult 0.5→0.7 to restore profitable level setups",
                "allowed": true,
                "size_mult": 1.0,
                "min_strength_counter_trend": 2.0,
                "counter_trend_size_mult": 0.7
            },
            "squeeze": {
                "allowed": true,
                "size_mult": 1.1
            }
        },
        "volume_confirmation": {
            "_comment": "From configuration.json - support_bounce min_volume_mult: 1.5",
            "threshold": 1.5,
            "bonus_mult": 1.1
        },
        "adx": {
            "_comment": "From configuration.json - vwap_min_adx: 8.0, adx_min_strength: 15",
            "high_adx_threshold": 35,
            "high_adx_size_mult": 0.9,
            "min_adx_for_vwap": 8.0
        },
        "level_touch": {
            "_comment": "From configuration.json - support_bounce_long",
            "min_touches": 2,
            "min_level_age_bars": 5,
            "level_merge_tolerance_pct": 0.3
        },
        "setup_filters": {
            "_comment": "DEEP DIVE FILTERS - 1-Year Backtest Analysis (72,042 trades, 231 sessions)",
            "_active_profile": "HOUR_OPTIMIZED_FILTERS",
            "_analysis_date": "2026-01-02",
            "_analysis_source": "Deep dive analysis with ALL parameters: cap, regime, hour, 2D/3D combinations",
            "range_bounce_short": {
                "enabled": true,
                "blocked_entirely": false,
                "_comment": "1-YEAR ANALYSIS: 514 trades, Rs 282 (Avg Rs 1). Filters improve significantly.",

                "allowed_caps": ["micro_cap", "small_cap"],
                "blocked_caps": ["mid_cap", "large_cap"],
                "_cap_evidence": "micro_cap: +Rs 7,511 (Avg Rs 119), small_cap: +Rs 4,945 | mid_cap: -Rs 12,175",

                "allowed_regimes": ["trend_down", "squeeze", "trend_up"],
                "blocked_regimes": ["chop"],
                "_regime_evidence": "trend_down: +Rs 14,912 (Avg Rs 83), squeeze: +Rs 1,830 | chop: -Rs 16,767 (Avg Rs -310)",

                "allowed_hours": [12, 13],
                "blocked_hours": [10, 11, 14, 15],
                "_hour_evidence": "12: +Rs 5,619, 13: +Rs 8,912 | 14: -Rs 14,250",

                "max_rsi": 60,
                "_rsi_evidence": "RSI 40-60: +Rs 14,148 | RSI 60-70: -Rs 15,288 (Avg Rs -172)",

                "min_adx": 25,
                "_adx_evidence": "ADX 25-30: -Rs 234, ADX 30-40: +Rs 8,518 | ADX 20-25: -Rs 6,998",

                "max_rank_score": 1.0,
                "_rank_evidence": "<1.0: +Rs 4,199 | 1.0-1.5: -Rs 2,705, 1.5-2.0: -Rs 1,212",

                "_expected_impact": "Remove ~300 losing trades. Remaining ~200 trades, ~Rs 25k PnL, Avg Rs 125"
            },
            "resistance_bounce_short": {
                "enabled": true,
                "allowed_caps": ["micro_cap", "small_cap", "mid_cap", "large_cap"],
                "allowed_regimes": ["chop", "squeeze"],
                "blocked_regimes": ["trend_down", "trend_up"],
                "allowed_hours": [15],
                "blocked_hours": [11, 12, 13, 14],
                "min_rank_score": 0,
                "_evidence": "DEEP DIVE: small_cap+15: Rs 364, 64.8% WR | chop+15: Rs 362, 66.3% WR | 11-14 LOSE Rs 1.46 MILLION!"
            },
            "vwap_lose_short": {
                "enabled": true,
                "allowed_caps": ["large_cap", "mid_cap", "small_cap"],
                "allowed_regimes": ["trend_down", "chop", "squeeze"],
                "blocked_regimes": ["trend_up"],
                "allowed_hours": [12, 13, 14, 15],
                "blocked_hours": [10, 11],
                "rsi_filter": {
                    "enabled": true,
                    "min_rsi": 40,
                    "_comment": "PARAM ANALYSIS: Block RSI 30-40 | NET save Rs 4,983"
                },
                "_evidence": "DEEP DIVE: large_cap+13: Rs 751, 95.2% WR | mid_cap+14: Rs 409, 78.6% WR | 10 LOSES Rs 41k | PARAM: block RSI 30-40"
            },
            "range_bounce_long": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "DEEP DIVE: -Rs 754,000 total PnL | WORST SETUP | NO winning hour combinations"
            },
            "support_bounce_long": {
                "enabled": true,
                "blocked_entirely": false,
                "_comment": "1-YEAR ANALYSIS: 117 trades, Rs 4,044 (Avg Rs 35). Filters improve to Avg Rs 150+.",

                "allowed_caps": ["micro_cap"],
                "_cap_evidence": "Only micro_cap traded",

                "allowed_regimes": ["chop"],
                "blocked_regimes": ["trend_down", "squeeze", "trend_up"],
                "_regime_evidence": "chop: +Rs 4,977 (Avg Rs 79) | trend_down: -Rs 156, squeeze: -Rs 777",

                "allowed_hours": [11],
                "blocked_hours": [12, 13, 14, 15],
                "_hour_evidence": "11: +Rs 7,305 (Avg Rs 77) | 12: -Rs 1,516, 14: -Rs 1,745",

                "min_rsi": 50,
                "max_rsi": 70,
                "_rsi_evidence": "RSI 50-60: +Rs 13,644 (Avg Rs 184), 60-70: +Rs 684 | RSI 40-50: -Rs 8,637 (Avg Rs -298)",

                "min_adx": 15,
                "_adx_evidence": "ADX 15-30: +Rs 6,871 | ADX <15: -Rs 2,826",

                "max_rank_score": 1.5,
                "_rank_evidence": "<1.0: +Rs 1,261, 1.0-1.5: +Rs 5,037 (Avg Rs 92) | 1.5-2.0: -Rs 2,254",

                "max_rr": 3.0,
                "_rr_evidence": "RR 2.0-3.0: +Rs 4,449 | RR >=3.0: -Rs 405",

                "_expected_impact": "Best combo chop+11: 51 trades, Rs 8,434, Avg Rs 165"
            },
            "discount_zone_long": {
                "enabled": true,
                "blocked_entirely": false,
                "allowed_caps": ["large_cap", "mid_cap"],
                "allowed_regimes": ["trend_up"],
                "allowed_hours": [12, 15],
                "blocked_hours": [11, 13, 14],
                "_evidence": "DEEP DIVE: trend_up+12: Rs 210, 79.1% WR | large_cap+trend_up+12: Rs 402, 92.3% WR | 13 LOSES Rs 64k"
            },
            "vwap_reclaim_long": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "DEEP DIVE: -Rs 60k total | Only large_cap+12 wins (Rs 216 avg) - not enough volume"
            },
            "orb_pullback_long": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "1-YEAR BACKTEST: 31 trades, 32.3% WR, -Rs 11,832. Not recoverable with filters.",
                "_old_config": {
                    "allowed_caps": ["mid_cap", "large_cap"],
                    "blocked_caps": ["small_cap"],
                    "allowed_regimes": ["chop", "squeeze"],
                    "allowed_hours": [9, 10, 11],
                    "blocked_hours": [12, 13, 14, 15],
                    "min_adx": 20,
                    "max_adx": 25
                },
                "rsi_filter": {
                    "enabled": true,
                    "max_rsi": 50,
                    "_comment": "PARAM ANALYSIS: Block RSI 50-60 | NET save Rs 2,232"
                },
                "_evidence": "DEEP DIVE: mid_cap+10: Rs 534, 96.9% WR | 15 LOSES Rs 73k | PARAM: block small_cap, ADX 15-20, RSI 50-60 (NET save Rs 19,277)"
            },
            "orb_pullback_short": {
                "enabled": true,
                "blocked_entirely": false,
                "allowed_caps": ["micro_cap", "large_cap"],
                "allowed_regimes": ["chop", "squeeze"],
                "blocked_regimes": ["trend_up"],
                "allowed_hours": [11, 12, 13],
                "blocked_hours": [10, 14, 15],
                "min_rank_score": 0,
                "_evidence": "DEEP DIVE: 11: Rs 291, 83.3% WR | chop+11: Rs 476, 86.7% WR | 10/15 LOSE"
            },
            "premium_zone_short": {
                "enabled": true,
                "blocked_entirely": false,
                "allowed_caps": ["micro_cap"],
                "allowed_regimes": ["trend_up", "trend_down"],
                "allowed_hours": [14],
                "blocked_hours": [15],
                "rsi_filter": {
                    "enabled": true,
                    "max_rsi": 50,
                    "_comment": "PARAM ANALYSIS: Block RSI 50-60 | NET save Rs 3,928"
                },
                "_evidence": "DEEP DIVE: micro_cap+14: Rs 424, 71.8% WR | Overall -Rs 26k but micro_cap+14 profitable | PARAM: block RSI 50-60"
            },
            "order_block_short": {
                "enabled": false,
                "_evidence": "Needs further analysis - keep disabled"
            },
            "order_block_long": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "BLOCKED: Long setups consistently losing"
            }
        },
        "global_filters": {
            "_comment": "Global filters that apply to all setups in this pipeline",
            "short_min_adx": {
                "enabled": false,
                "min_adx": 18,
                "_evidence": "ADX < 15 = 0% WR. ADX 20-25 = 62% WR. Min 18 catches weak trends."
            },
            "long_min_volume": {
                "enabled": false,
                "min_volume": 150000,
                "_evidence": "Winners have 2x volume (213k vs 107k)."
            },
            "rsi_dead_zone": {
                "enabled": false,
                "long_min": 35,
                "long_max": 50,
                "_comment": "Disabled for LEVEL - handled by setup-specific RSI filters"
            }
        },
        "vwap_freshness": {
            "_comment": "Parameters for fresh reclaim/lose detection",
            "reclaim_lookback_bars": 12,
            "max_bars_above_for_reclaim": 8,
            "lose_lookback_bars": 12,
            "max_bars_below_for_lose": 8
        },
        "vwap_volume": {
            "_comment": "DATA-DRIVEN (Dec 2024): VWAP vol<50k: 18 trades (6W, 12L), blocking = +2,675 Rs improvement",
            "enabled": false,
            "min_volume": 50000,
            "_evidence": "DISABLED for A/B baseline"
        },
        "specialized_filters": {
            "_comment": "DISABLED - 1-Year A/B Testing Baseline",
            "resistance_bounce_short_bb_width": {
                "enabled": false,
                "max_bb_width": 0.10,
                "_evidence": "DISABLED for A/B baseline"
            }
        },
        "long_specific_filters": {
            "_comment": "DATA-DRIVEN (Dec 2024): Filters specific to long trades based on winner/loser analysis",
            "rsi_max": {
                "threshold": 65,
                "_evidence": "RSI>=70: 9.3% WR (7W/75T). RSI<60: 16.4% WR (32W/195T). High RSI = chasing exhausted moves."
            },
            "entry_time_cutoff": {
                "last_entry_hour": 11,
                "last_entry_minute": 30,
                "_evidence": "09:15-11:00: 19% WR. 11:00-12:00: 11% WR. 13:00+: 7.7% WR. After 14:00: 0% WR."
            },
            "squeeze_regime_boost": {
                "size_mult": 1.3,
                "_evidence": "55.6% of winning longs came from squeeze regime vs only 20% from trend_up."
            },
            "max_hold_minutes": {
                "enabled": true,
                "limit": 120,
                "_evidence": "Pro traders hold 30-90 min max. After 2 hours, momentum fades. Time-based exit if no T1 hit."
            }
        }
    },

    "ranking": {
        "_comment": "LEVEL-SPECIFIC RANKING (Dec 2024) - Pro trader research: low ADX, extreme RSI, counter-VWAP acceptable for bounces",
        "mode": "level_specific",
        "score_scale": 5.0,
        "_score_scale_note": "Multiplier to scale weighted sum back to usable range (~0-5). Weighted sum alone produces ~0.17 mean.",
        "weights": {
            "volume": {
                "_comment": "REDUCED weight for level plays - structure matters more than volume",
                "divisor": 3.0,
                "cap": 1.5,
                "weight": 0.10
            },
            "rsi": {
                "_comment": "INVERTED: Extreme RSI = GOOD for bounces (oversold for long, overbought for short)",
                "mode": "extreme_is_good",
                "long_oversold_threshold": 40,
                "long_very_oversold_threshold": 30,
                "long_overbought_penalty_threshold": 65,
                "short_overbought_threshold": 60,
                "short_very_overbought_threshold": 70,
                "short_oversold_penalty_threshold": 35,
                "extreme_bonus": 0.5,
                "good_bonus": 0.3,
                "penalty": -0.3,
                "weight": 0.20
            },
            "adx": {
                "_comment": "INVERTED: Low ADX = GOOD for bounces (ranging market, levels respected)",
                "mode": "low_is_good",
                "ideal_max": 20,
                "acceptable_max": 25,
                "penalty_threshold": 35,
                "ideal_bonus": 0.4,
                "acceptable_bonus": 0.2,
                "penalty": -0.3,
                "weight": 0.25
            },
            "vwap": {
                "_comment": "RELAXED: Counter-VWAP acceptable for reversal setups",
                "mode": "counter_allowed",
                "aligned_bonus": 0.2,
                "counter_bonus": 0.1,
                "weight": 0.10
            },
            "distance": {
                "_comment": "KEEP HIGH WEIGHT: Near level = critical for bounce setups",
                "near_bpct": 0.5,
                "near_score": 0.4,
                "ok_bpct": 1.5,
                "ok_score": 0.2,
                "far_score": -0.1,
                "weight": 0.25
            },
            "squeeze": {
                "_comment": "Low squeeze = good for level plays (ranging, levels respected)",
                "low_bonus": 0.3,
                "mid_bonus": 0.2,
                "high_penalty": -0.2,
                "weight": 0.10
            },
            "acceptance": {
                "_comment": "Quality bonus for LEVEL trades - excellent/good quality get ranking boost",
                "enabled": true,
                "excellent_bonus": 0.4,
                "good_bonus": 0.2,
                "weight": 0.10
            }
        },
        "daily_trend_multipliers": {
            "aligned": 1.25,
            "counter": 0.75,
            "neutral": 1.0
        },
        "regime_multipliers": {
            "_comment": "Default fallback multipliers",
            "chop": 1.3,
            "squeeze": 1.2,
            "trend_up": 1.0,
            "trend_down": 1.0
        },
        "strategy_regime_multipliers": {
            "_comment": "From baseline ranker.py _get_regime_multiplier() - Strategy-specific overrides for LEVEL setups",
            "support_bounce": {
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 1.0,
                "trend_down": 1.0,
                "default": 1.0
            },
            "resistance_bounce": {
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 1.0,
                "trend_down": 1.0,
                "default": 1.0
            },
            "vwap_reclaim": {
                "_comment": "VWAP strategies similar to mean reversion - chop boost",
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 1.2,
                "trend_down": 1.2,
                "default": 1.2
            },
            "vwap_lose": {
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 1.2,
                "trend_down": 1.2,
                "default": 1.2
            },
            "premium_zone": {
                "_comment": "From baseline: chop=1.3, trend=0.9 - premium/discount zones work best in ranging",
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 0.9,
                "trend_down": 0.9,
                "default": 1.0
            },
            "discount_zone": {
                "_comment": "From baseline: chop=1.3, trend=0.9 - premium/discount zones work best in ranging",
                "chop": 1.3,
                "squeeze": 1.2,
                "trend_up": 0.9,
                "trend_down": 0.9,
                "default": 1.0
            },
            "orb_pullback": {
                "chop": 1.1,
                "squeeze": 1.0,
                "trend_up": 1.1,
                "trend_down": 1.1,
                "default": 1.0
            },
            "order_block": {
                "_comment": "From baseline: trend=1.2, chop=1.1 - order blocks work in all conditions",
                "trend_up": 1.2,
                "trend_down": 1.2,
                "chop": 1.1,
                "squeeze": 1.1,
                "default": 1.0
            }
        }
    },

    "entry": {
        "_comment": "WIDENED (Dec 2024): zone_mult_atr 0.3->0.5, min_zone_pct 0.25->0.30. Zero-trigger setups had 0.10-0.20% zones.",
        "zone_mult_atr": 0.5,
        "min_zone_pct": 0.30,
        "mode": {
            "pullback": "retest",
            "retest": "retest",
            "default": "conditional"
        },
        "triggers": {
            "vwap": "vwap_level",
            "premium_zone": "zone_entry",
            "discount_zone": "zone_entry",
            "default": "level_bounce"
        },
        "ict_zones": {
            "_comment": "From configuration.json ict_comprehensive - premium_threshold_pct: 70, discount_threshold_pct: 30",
            "discount_zone_frac": 0.30,
            "premium_zone_frac": 0.70
        },
        "retest_timeout_minutes": 45
    },

    "targets": {
        "_comment": "DATA-DRIVEN (Dec 2024): Setup-specific targets optimized via 1m backtest simulation",
        "rr_ratios": {
            "support_bounce_long": {
                "_comment": "OPTIMIZED Dec 2024: T1 1.0R + SL 0.9x. Tighter targets = 79% hit rate. +Rs 9.15L improvement over 3yr",
                "t1": 1.0,
                "t2": 1.25,
                "t3": 1.5
            },
            "resistance_bounce_short": {
                "_comment": "OPTIMIZED Dec 2024: T1 3.0R + SL 1.5x. Wider targets = let winners run. +Rs 5.12L improvement over 3yr",
                "t1": 3.0,
                "t2": 3.5,
                "t3": 4.0
            },
            "range_bounce_short": {
                "_comment": "OPTIMIZED Dec 2024: T1 3.0R + SL 1.5x. Wider targets = let winners run. +Rs 4.83L improvement over 3yr",
                "t1": 3.0,
                "t2": 3.5,
                "t3": 4.0
            },
            "orb_pullback_long": {
                "_comment": "OPTIMIZED Dec 2024: SL 1.0x, T1 2.0R. 98 filtered trades -> NET Rs 29,929 (56.1% WR). +Rs 19K improvement.",
                "t1": 2.0,
                "t2": 2.5,
                "t3": 3.0
            },
            "orb_pullback_short": {
                "_comment": "OPTIMIZED Dec 2024: SL 1.5x, T1 1.75R. 694 filtered trades -> NET Rs 281,102 (65.3% WR). +Rs 215K improvement.",
                "t1": 1.75,
                "t2": 2.25,
                "t3": 2.75
            },
            "long": {
                "_comment": "Default for other long setups: T1 1.0R (tighter targets work better for longs)",
                "t1": 1.0,
                "t2": 1.5,
                "t3": 2.0
            },
            "short": {
                "_comment": "Default for other short setups: T1 1.5R",
                "t1": 1.5,
                "t2": 2.5,
                "t3": 3.0
            },
            "t1": 1.5,
            "t2": 2.5,
            "t3": 3.0
        },
        "qty_splits": {
            "_comment": "60-40 split to match OLD config - T3 disabled (0%)",
            "t1": 0.60,
            "t2": 0.40,
            "t3": 0.0
        },
        "caps": {
            "_comment": "FIXED: max_pct was 1.0 (1%) - way too restrictive! Old config uses 100%. Targets need to reach 2-3R for positive expectancy.",
            "t1": {
                "measured_move_frac": 2.0,
                "max_pct": 100.0
            },
            "t2": {
                "measured_move_frac": 3.0,
                "max_pct": 100.0
            },
            "t3": {
                "measured_move_frac": 4.0,
                "max_pct": 100.0
            }
        },
        "trail": {
            "after_t1": {
                "move_sl_to": "entry",
                "offset_atr": 0.05
            },
            "after_t2": {
                "move_sl_to": "t1",
                "offset_atr": 0.0
            }
        }
    },

    "stop_loss": {
        "_comment": "DATA-DRIVEN (Dec 2024): Setup-specific SL optimized via 1m backtest simulation",
        "atr_multiplier": 2.0,
        "min_stop_distance_pct": 0.5,
        "setup_specific": {
            "support_bounce_long": {
                "atr_multiplier": 1.8,
                "_comment": "OPTIMIZED Dec 2024: 0.9x tighter SL (2.0→1.8 ATR). Tighter SL + T1 1.0R = +Rs 9.15L over 3yr"
            },
            "resistance_bounce_short": {
                "atr_multiplier": 3.0,
                "_comment": "OPTIMIZED Dec 2024: 1.5x wider SL (2.0→3.0 ATR). More room + T1 3.0R = +Rs 5.12L over 3yr"
            },
            "range_bounce_short": {
                "atr_multiplier": 3.0,
                "_comment": "OPTIMIZED Dec 2024: 1.5x wider SL (2.0→3.0 ATR). More room + T1 3.0R = +Rs 4.83L over 3yr"
            }
        }
    },

    "rsi_penalty": {
        "_comment": "LEVEL: Penalize extreme RSI (price may overshoot level)",
        "extreme_high": 75,
        "extreme_low": 25,
        "penalty_mult": 0.9
    }
}

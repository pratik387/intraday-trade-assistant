{
    "_comment": "BREAKOUT Pipeline Configuration - All values from configuration.json and pro Indian trading standards",
    "_category": "BREAKOUT",
    "_description": "Momentum breaks of key levels (ORB, flag continuation, squeeze release, etc.)",

    "setup_types": [
        "breakout_long", "breakout_short",
        "orb_breakout_long", "orb_breakout_short",
        "orb_breakdown_long", "orb_breakdown_short",
        "flag_continuation_long", "flag_continuation_short",
        "squeeze_release_long", "squeeze_release_short",
        "momentum_breakout_long", "momentum_breakout_short",
        "range_breakout_long", "range_breakout_short",
        "range_breakdown_long", "range_breakdown_short",
        "gap_breakout_long", "gap_breakout_short",
        "resistance_breakout_long", "resistance_breakout_short",
        "support_breakdown_long", "support_breakdown_short",
        "break_of_structure_long", "break_of_structure_short",
        "change_of_character_long", "change_of_character_short",
        "equilibrium_breakout_long", "equilibrium_breakout_short",
        "level_breakout_long", "level_breakout_short",
        "orb_level_breakout_long", "orb_level_breakout_short",
        "first_hour_momentum_long", "first_hour_momentum_short"
    ],

    "screening": {
        "_comment": "Category-specific screening filters - DISABLED for A/B baseline",
        "enabled": false,
        "time_windows": {
            "_comment": "From configuration.json time_policy - NSE trading hours",
            "morning_start": "09:15",
            "morning_end": "12:00",
            "lunch_block_start": "12:00",
            "lunch_block_end": "13:00",
            "afternoon_start": "13:00",
            "afternoon_end": "14:45",
            "last_entry_cutoff": "14:45",
            "opening_bell_start": "09:15",
            "opening_bell_end": "09:30"
        },
        "momentum_consolidation": {
            "enabled": true,
            "threshold_pct": 1.0,
            "vwap_deviation_threshold": 0.02,
            "volume_ratio_threshold": 1.5
        },
        "first_hour_momentum": {
            "_comment": "FHM screening config - PRO STANDARD: RVOL>=2.0x indicates institutional activity",
            "enabled": true,
            "time_window": {
                "start": "09:20",
                "end": "10:30"
            },
            "triggers": {
                "min_rvol": 2.0,
                "min_rvol_comment": "PRO: RVOL>2x indicates possible big move (institutional). Was 1.5x - too low per industry research.",
                "min_price_move_pct": 1.5,
                "min_volume_1m": 50000
            },
            "stop_loss": {
                "_comment": "DATA-DRIVEN (Dec 2024): 1m simulation showed 1.2% optimal",
                "pct_of_price": 0.012,
                "use_structure": true,
                "_rationale": "WIDENED: 0.8%->1.2% based on 1m bar simulation. Avg MAE was 0.53%, tight SL hit on recoverable moves."
            }
        },
        "min_bars_required": 4
    },

    "quality": {
        "_comment": "From configuration.json - min_t1_rr: 1.2, t1_rr: 1.5",
        "min_structural_rr": 1.2,
        "volume_ratio_floor": 0.5,
        "quality_thresholds": {
            "excellent": {
                "min_structural_rr": 2.0,
                "min_volume_ratio": 1.5
            },
            "good": {
                "min_structural_rr": 1.5,
                "min_volume_ratio": 1.3
            },
            "fair": {
                "min_structural_rr": 1.2,
                "min_volume_ratio": 1.0
            }
        }
    },

    "gates": {
        "_comment": "From configuration.json - breakout_volume_surge_min: 1.5 (long), 2.0 (short), breakout_momentum_candle_min_ratio: 2.0 (long), 2.5 (short)",
        "volume_surge": {
            "enabled": false,
            "_ab_baseline_comment": "DISABLED for A/B baseline",
            "long": {
                "min_ratio": 1.5,
                "lookback_bars": 20
            },
            "short": {
                "min_ratio": 2.0,
                "lookback_bars": 20
            }
        },
        "momentum_candle": {
            "enabled": false,
            "_ab_baseline_comment": "DISABLED for A/B baseline",
            "long": {
                "min_ratio": 2.0
            },
            "short": {
                "min_ratio": 2.5
            }
        },
        "adx": {
            "enabled": false,
            "_ab_baseline_comment": "DISABLED for A/B baseline",
            "_comment": "From configuration.json - breakout_min_adx: 20.0, adx_min_strength: 15, adx_min_trend: 20",
            "min_value": 20,
            "orb_early_min_value": 15,
            "_orb_early_comment": "ORB EARLY WINDOW FIX: Pro traders use relaxed ADX (15) for early ORB because ADX takes 14+ bars to stabilize",
            "_fhm_note": "FHM bypasses ADX - uses RVOL-based momentum (RVOL >= 2x is the signal)",
            "low_adx_threshold": 15,
            "low_adx_size_mult": 0.8
        },
        "regime_rules": {
            "enabled": false,
            "_ab_baseline_comment": "DISABLED regime gates for A/B baseline",
            "chop": {
                "_comment": "DATA-DRIVEN (Dec 2024): ORB CHOP winners have 283k volume vs losers 107k (+164%), winners have srr 1.28 vs losers 2.28 (-44%)",
                "allowed": true,
                "size_mult": 0.7,
                "orb_chop_min_volume": 150000,
                "orb_chop_max_structural_rr": 1.8,
                "_orb_chop_evidence": "Filter vol>=150k AND srr<1.8: 54 trades, 64.8% WR, +5,190 Rs. Turns -8,404 Rs loser into +5,190 Rs winner. Improvement: +13,594 Rs"
            },
            "trend_up": {
                "allowed": true,
                "size_mult": 1.0
            },
            "trend_down": {
                "allowed": true,
                "size_mult": 1.0
            },
            "squeeze": {
                "_comment": "DATA-DRIVEN: 55.6% of winning longs came from squeeze regime. BOOSTED from 0.9 to 1.2 for longs.",
                "allowed": true,
                "size_mult": 1.2,
                "long_size_mult": 1.3
            }
        },
        "validated_filters": {
            "_comment": "DISABLED - 1-Year A/B Testing Baseline (NOTE: This section is legacy/unused in code)",
            "first_hour_momentum_long": {
                "_comment": "DISABLED for A/B baseline",
                "enabled": false,
                "blocked_caps": [],
                "max_adx": 25,
                "_evidence": "DISABLED for A/B baseline"
            },
            "breakout_long_hour_11": {
                "enabled": false,
                "blocked_hours": [],
                "_evidence": "DISABLED for A/B baseline"
            },
            "long_trade_volume": {
                "enabled": false,
                "min_volume": 150000,
                "_evidence": "DISABLED for A/B baseline"
            },
            "orb_breakout_long_cap_filter": {
                "_comment": "DISABLED for A/B baseline",
                "enabled": false,
                "allowed_caps": [],
                "mid_cap_with_filters": {
                    "enabled": false,
                    "min_structural_rr": 1.5,
                    "min_entry_minute": 35
                },
                "_evidence": "DISABLED for A/B baseline"
            }
        },
        "long_specific_filters": {
            "_comment": "DATA-DRIVEN (Dec 2024): Filters specific to long trades based on winner/loser analysis",
            "rsi_max": {
                "threshold": 65,
                "_evidence": "RSI>=70: 9.3% WR (7W/75T). RSI<60: 16.4% WR (32W/195T). High RSI = chasing exhausted moves."
            },
            "entry_time_cutoff": {
                "last_entry_hour": 11,
                "last_entry_minute": 30,
                "_evidence": "09:15-11:00: 19% WR. 11:00-12:00: 11% WR. 13:00+: 7.7% WR. After 14:00: 0% WR."
            },
            "squeeze_regime_boost": {
                "size_mult": 1.3,
                "_evidence": "55.6% of winning longs came from squeeze regime vs only 20% from trend_up."
            },
            "max_hold_minutes": {
                "enabled": true,
                "limit": 120,
                "_evidence": "Pro ORB traders hold 30-90 min max. After 2 hours, momentum fades. Time-based exit if no T1 hit."
            }
        },
        "setup_filters": {
            "_comment": "DEEP DIVE FILTERS - 1-Year Backtest Analysis (72,042 trades, 231 sessions)",
            "_active_profile": "HOUR_OPTIMIZED_FILTERS",
            "_analysis_date": "2026-01-02",
            "_analysis_source": "Deep dive analysis with ALL parameters: cap, regime, hour, 2D/3D combinations",
            "breakout_long": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "DEEP DIVE: -Rs 75k total | NO winning hour combinations | 15 only marginally positive"
            },
            "breakout_short": {
                "enabled": false,
                "_evidence": "Needs further analysis - keep disabled"
            },
            "first_hour_momentum_long": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "DEEP DIVE: -Rs 44k total | Only small_cap+11 wins (Rs 319) - insufficient volume"
            },
            "first_hour_momentum_short": {
                "enabled": false,
                "_evidence": "Needs further analysis - keep disabled"
            },
            "orb_breakout_long": {
                "enabled": true,
                "blocked_entirely": false,
                "allowed_caps": ["mid_cap", "large_cap", "small_cap"],
                "allowed_regimes": ["chop", "trend_down"],
                "allowed_hours": [9, 10, 11],
                "blocked_hours": [12, 13, 14, 15],
                "max_rsi": 60,
                "min_rr": 1.5,
                "_evidence": "DEEP DIVE: 9: Rs 246, 94.7% WR | 10: Rs 200, 92.5% WR | 15 LOSES Rs 234k | PARAM: block RSI>=60 (NEW: tightened from 70, saves Rs 2,948)"
            },
            "orb_breakout_short": {
                "enabled": false,
                "_evidence": "Needs further analysis - keep disabled"
            },
            "orb_breakdown_long": {
                "enabled": false,
                "_evidence": "No data in backtest - keep disabled"
            },
            "orb_breakdown_short": {
                "enabled": true,
                "blocked_entirely": false,
                "allowed_caps": ["micro_cap"],
                "allowed_regimes": ["trend_down", "squeeze", "chop"],
                "allowed_hours": [9, 10, 11, 12, 13, 14],
                "blocked_hours": [15],
                "_evidence": "DEEP DIVE: micro_cap+11: Rs 221, 86.1% WR | 15 LOSES Rs 176k | Overall only Rs 20 avg but micro_cap+morning is profitable"
            },
            "change_of_character_long": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "DEEP DIVE: -Rs 7k total | Only squeeze+11 wins (Rs 479) - very low volume"
            },
            "change_of_character_short": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "DEEP DIVE: -Rs 2k total | Only 15 positive (Rs 218) but low volume, not reliable"
            },
            "break_of_structure_long": {
                "enabled": true,
                "_comment": "PRO ICT 2025: Detection logic overhauled - retest entry, HH/HL structure validation. Filters reset for fresh backtest.",
                "_old_filters": "blocked_caps: micro_cap/small_cap, blocked_regimes: trend_down/trend_up, max_adx: 40, max_rr: 3.0"
            },
            "break_of_structure_short": {
                "enabled": true,
                "_comment": "PRO ICT 2025: Detection logic overhauled - retest entry, HH/HL structure validation. Filters reset for fresh backtest.",
                "_old_filters": "blocked_caps: micro_cap, blocked_regimes: trend_up, allowed_hours: 13/15"
            },
            "squeeze_release_long": {
                "enabled": true,
                "blocked_entirely": false,
                "allowed_caps": ["mid_cap"],
                "blocked_caps": ["micro_cap"],
                "allowed_regimes": ["trend_up", "trend_down"],
                "blocked_regimes": ["chop", "squeeze"],
                "allowed_hours": [15],
                "blocked_hours": [12, 13, 14],
                "rsi_filter": {
                    "enabled": true,
                    "max_rsi": 50,
                    "_comment": "PARAM ANALYSIS: Block RSI 50-60 | NET save Rs 28,037"
                },
                "_evidence": "DEEP DIVE: mid_cap+trend_up: Rs 222, 68.1% WR | 12-14 LOSE Rs 29k | PARAM: block RSI 50-60, micro_cap (NET save Rs 36,480)"
            },
            "squeeze_release_short": {
                "enabled": true,
                "blocked_entirely": false,
                "allowed_caps": ["small_cap"],
                "allowed_regimes": ["trend_down", "trend_up"],
                "blocked_regimes": ["chop", "squeeze"],
                "allowed_hours": [14, 15],
                "blocked_hours": [12, 13],
                "min_adx": 20,
                "rsi_filter": {
                    "enabled": true,
                    "max_rsi": 50,
                    "_comment": "PARAM ANALYSIS: Block RSI 50-60, ADX 15-20 | NET save Rs 16,281"
                },
                "_evidence": "DEEP DIVE: small_cap+trend_down+14: Rs 537, 76.5% WR | 12/13 LOSE Rs 11k | PARAM: block RSI 50-60, ADX 15-20"
            },
            "momentum_breakout_long": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "DEEP DIVE: -Rs 226k total | ONLY mid_cap+chop+12 wins (Rs 439) - not enough volume to justify",
                "_moved_from": "momentum_config.json (WRONG - belongs to BREAKOUT pipeline)"
            },
            "momentum_breakout_short": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "DEEP DIVE: -Rs 49k total | No winning combinations found",
                "_moved_from": "momentum_config.json (WRONG - belongs to BREAKOUT pipeline)"
            },
            "flag_continuation_long": {
                "enabled": true,
                "blocked_entirely": true,
                "_evidence": "DEEP DIVE: -Rs 1k total | Only large_cap profitable but low volume",
                "_moved_from": "momentum_config.json (WRONG - belongs to BREAKOUT pipeline)"
            },
            "flag_continuation_short": {
                "enabled": true,
                "blocked_entirely": false,
                "allowed_caps": ["mid_cap", "small_cap"],
                "blocked_caps": ["large_cap", "micro_cap"],
                "allowed_regimes": ["chop"],
                "allowed_hours": [15],
                "blocked_hours": [13, 14],
                "_evidence": "DEEP DIVE: mid_cap+chop: Rs 463, 63.6% WR | 13/14 LOSE | PARAM: block large_cap (Rs 2,364), micro_cap (Rs 2,624)",
                "_moved_from": "momentum_config.json (WRONG - belongs to BREAKOUT pipeline)"
            }
        },
        "global_filters": {
            "_comment": "UNIFIED GLOBAL FILTERS - Applied to all setups before setup-specific filters",
            "short_min_adx": {
                "enabled": false,
                "min_adx": 25,
                "_rationale": "Shorts need stronger trend confirmation"
            },
            "long_min_volume": {
                "enabled": false,
                "min_volume": 100000,
                "_rationale": "Longs need minimum institutional volume (FHM bypasses this)"
            },
            "rsi_dead_zone": {
                "enabled": false,
                "min_rsi": 45,
                "max_rsi": 55,
                "_rationale": "Disabled for breakout - momentum can start from any RSI level"
            }
        },
        "specialized_filters": {
            "_comment": "Complex filters requiring specialized logic (kept in validate_gates() code)",
            "orb_cap_filter_with_mid_cap_conditions": {
                "_note": "mid_cap allowed if structural_rr >= 1.5 AND entry_minute >= 35",
                "enabled": false,
                "mid_cap_min_structural_rr": 1.5,
                "mid_cap_min_entry_minute": 35
            },
            "fhm_bypass": {
                "_note": "FHM bypasses volume, ADX, RSI checks - uses RVOL from screening",
                "enabled": false
            },
            "orb_relaxed_thresholds": {
                "_note": "ORB uses relaxed ADX (15) and RSI thresholds - market open volatility",
                "enabled": false
            }
        }
    },

    "ranking": {
        "_comment": "BREAKOUT-SPECIFIC RANKING (Dec 2024) - Pro trader research: high ADX, neutral RSI, VWAP aligned critical",
        "mode": "breakout_specific",
        "score_scale": 5.0,
        "_score_scale_note": "Multiplier to scale weighted sum back to usable range (~0-5). Weighted sum alone produces ~0.17 mean.",
        "weights": {
            "volume": {
                "_comment": "CRITICAL for breakouts - volume confirms breakout validity",
                "divisor": 2.0,
                "cap": 2.0,
                "weight": 0.20
            },
            "rsi": {
                "_comment": "NEUTRAL = GOOD for breakouts (room to run, not overbought/oversold)",
                "mode": "neutral_is_good",
                "neutral_min": 45,
                "neutral_max": 55,
                "good_min": 40,
                "good_max": 60,
                "long_overbought_threshold": 70,
                "short_oversold_threshold": 30,
                "neutral_bonus": 0.4,
                "good_bonus": 0.2,
                "penalty": -0.3,
                "weight": 0.15
            },
            "adx": {
                "_comment": "HIGH ADX = GOOD for breakouts (strong trend confirms momentum)",
                "mode": "high_is_good",
                "strong_threshold": 35,
                "good_threshold": 25,
                "weak_threshold": 20,
                "strong_bonus": 0.5,
                "good_bonus": 0.3,
                "weak_penalty": -0.3,
                "weight": 0.20
            },
            "vwap": {
                "_comment": "ALIGNED = CRITICAL for breakouts (momentum in direction of VWAP)",
                "mode": "aligned_required",
                "aligned_bonus": 0.5,
                "misaligned_penalty": -0.4,
                "weight": 0.15
            },
            "distance": {
                "_comment": "Less critical for breakouts - already broken out from level",
                "near_bpct": 0.5,
                "near_score": 0.3,
                "ok_bpct": 1.5,
                "ok_score": 0.1,
                "far_score": -0.1,
                "weight": 0.10
            },
            "squeeze": {
                "_comment": "Squeeze release = good for breakouts (pent-up energy)",
                "low_bonus": 0.3,
                "mid_bonus": 0.2,
                "high_penalty": -0.2,
                "weight": 0.10
            },
            "acceptance": {
                "_comment": "KEEP for breakouts - structural R:R matters for momentum plays",
                "enabled": true,
                "excellent_bonus": 0.4,
                "good_bonus": 0.2,
                "weight": 0.10
            }
        },
        "regime_multipliers": {
            "_comment": "Default fallback multipliers",
            "trend_up": 1.1,
            "trend_down": 1.1,
            "chop": 0.7,
            "squeeze": 1.0
        },
        "strategy_regime_multipliers": {
            "_comment": "From baseline ranker.py _get_regime_multiplier() - Strategy-specific overrides",
            "breakout": {
                "_comment": "Breakout poor in chop per baseline report",
                "chop": 0.7,
                "trend_up": 1.1,
                "trend_down": 1.1,
                "squeeze": 0.9,
                "default": 0.9
            },
            "orb_breakout": {
                "chop": 0.7,
                "trend_up": 1.1,
                "trend_down": 1.1,
                "squeeze": 0.9,
                "default": 0.9
            },
            "orb_breakdown": {
                "chop": 0.7,
                "trend_up": 1.1,
                "trend_down": 1.1,
                "squeeze": 0.9,
                "default": 0.9
            },
            "momentum_breakout": {
                "_comment": "From baseline: trend=1.4, chop=1.3, other=1.2",
                "trend_up": 1.4,
                "trend_down": 1.4,
                "chop": 1.3,
                "squeeze": 1.2,
                "default": 1.2
            },
            "flag_continuation": {
                "trend_up": 1.4,
                "trend_down": 1.4,
                "chop": 1.1,
                "squeeze": 1.2,
                "default": 1.1
            },
            "squeeze_release": {
                "squeeze": 1.5,
                "chop": 1.3,
                "trend_up": 1.2,
                "trend_down": 1.2,
                "default": 1.1
            },
            "break_of_structure": {
                "_comment": "From baseline: 1.2 constant for structural shifts",
                "trend_up": 1.2,
                "trend_down": 1.2,
                "chop": 1.2,
                "squeeze": 1.2,
                "default": 1.2
            },
            "change_of_character": {
                "_comment": "From baseline: trend=1.4, chop=0.8",
                "trend_up": 1.4,
                "trend_down": 1.4,
                "chop": 0.8,
                "squeeze": 1.0,
                "default": 1.0
            },
            "first_hour_momentum": {
                "_comment": "FHM: High multipliers across all regimes - momentum trumps regime in first hour",
                "trend_up": 1.5,
                "trend_down": 1.5,
                "chop": 1.3,
                "squeeze": 1.4,
                "default": 1.3
            }
        },
        "daily_trend_multipliers": {
            "aligned": 1.25,
            "counter": 0.75,
            "neutral": 1.0
        }
    },

    "entry": {
        "_comment": "WIDENED (Dec 2024): zone_mult_atr 0.25->0.4, min_zone_pct 0.20->0.25. flag_continuation had 0.31% zones -> 0 triggers.",
        "zone_mult_atr": 0.4,
        "min_zone_pct": 0.25,
        "min_breakout_atr_mult": 0.3,
        "mode": "immediate",
        "triggers": {
            "long": "breakout_above_level",
            "short": "breakdown_below_level"
        }
    },

    "targets": {
        "_comment": "DATA-DRIVEN (Dec 2024): FHM 1m simulation showed 1.2% SL + 1.5R T1 = +348% improvement. Higher T1 captures momentum.",
        "rr_ratios": {
            "long": {
                "_comment": "RAISED: T1 1.0R→1.5R for longs. FHM 1m simulation: 55 trades, Rs 1,886 baseline → Rs 8,451 with 1.5R.",
                "t1": 1.5,
                "t2": 2.5,
                "t3": 3.5
            },
            "short": {
                "_comment": "Shorts keep 1.5R T1 - they have 1.13R avg MFE vs 0.74R for longs",
                "t1": 1.5,
                "t2": 3.0,
                "t3": 4.0
            },
            "t1": 1.5,
            "t2": 3.0,
            "t3": 4.0
        },
        "qty_splits": {
            "_comment": "70-30 split - DATA-DRIVEN: Higher T1 exit due to high hard SL rate (~41%)",
            "t1": 0.70,
            "t2": 0.30,
            "t3": 0.0
        },
        "caps": {
            "_comment": "FIXED: max_pct was 1.0 (1%) - way too restrictive! Old config uses 100%. Targets need to reach 2-3R for positive expectancy.",
            "t1": {
                "measured_move_frac": 2.0,
                "max_pct": 100.0
            },
            "t2": {
                "measured_move_frac": 3.0,
                "max_pct": 100.0
            },
            "t3": {
                "measured_move_frac": 4.0,
                "max_pct": 100.0
            }
        },
        "trail": {
            "after_t1": {
                "move_sl_to": "entry",
                "offset_atr": 0.1
            },
            "after_t2": {
                "move_sl_to": "t1",
                "offset_atr": 0.0
            }
        }
    },

    "stop_loss": {
        "_comment": "From baseline configuration.json (commit 3ded63d) - sl_atr_mult: 2.0",
        "atr_multiplier": 2.0
    },

    "orb_target_recalculation": {
        "_comment": "Pro ORB traders (Toby Crabel, Mark Fisher) use OR range for targets. Recalculated at trigger time based on actual entry.",
        "enabled": true,
        "t1_or_range_mult": 1.0,
        "t2_or_range_mult": 1.5,
        "sl_buffer_or_range_mult": 0.1,
        "qty_splits": {
            "t1": 0.60,
            "t2": 0.40,
            "t3": 0.0
        },
        "_evidence": "OR-based targets are achievable within normal ORB price action. R-multiples can push targets too far when actual entry differs from planned entry."
    },

    "rsi_penalty": {
        "enabled": false,
        "_ab_baseline_comment": "DISABLED for A/B baseline",
        "_comment": "BREAKOUT: Penalize weak momentum (low RSI for longs, high RSI for shorts)",
        "long_weak_threshold": 40,
        "short_weak_threshold": 60,
        "orb_early_long_threshold": 35,
        "orb_early_short_threshold": 55,
        "_orb_early_comment": "ORB EARLY WINDOW FIX: Pro traders use relaxed RSI thresholds for early ORB because RSI is erratic at market open",
        "penalty_mult": 0.9
    }
}
